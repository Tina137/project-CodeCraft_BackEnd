{
  "openapi": "3.1.0",
  "info": {
    "version": "1.0.0",
    "title": "Contacts app",
    "license": {
      "name": "Apache 2.0",
      "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
    },
    "description": "This is the Api documentation for Traveler site, platform where travelers share their stories, experiences, and adventures. The API enables user management, story creation, media uploads, and community interactions."
  },
  "servers": [
    {
      "url": "http://localhost:3000/api",
      "description": "Local development server"
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Authorization routes for user registration, login, logout, and password management."
    },
    {
      "name": "Users",
      "description": "Operations about users, including profile management and retrieval."
    },
    {
      "name": "Stories",
      "description": "Operations related to traveler stories, including creation, retrieval, updating, and deletion."
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "User Registration",
        "description": "Register a new user with name, email, and password.",
        "operationId": "registerUser",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The user's name.",
                    "example": "Ivan Petrenko"
                  },
                  "email": {
                    "type": "string",
                    "description": "The user's email address.",
                    "example": "ivan@example.com"
                  },
                  "password": {
                    "type": "string",
                    "description": "The user's password.",
                    "example": "strongpassword123"
                  }
                },
                "required": [
                  "name",
                  "email",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "$ref": "#/components/responses/201"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "409": {
            "$ref": "#/components/responses/409"
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "User Login",
        "description": "Authenticate a user and return a JWT token.",
        "operationId": "loginUser",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "description": "The user's email address.",
                    "example": "ivan@example.com"
                  },
                  "password": {
                    "type": "string",
                    "description": "The user's password.",
                    "example": "strongpassword123"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/auth/logout": {
      "post": {
        "summary": "User Logout",
        "description": "Logout the authenticated user by invalidating the session.",
        "operationId": "logoutUser",
        "tags": [
          "Auth"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "204": {
            "$ref": "#/components/responses/204"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/auth/send-reset-email": {
      "post": {
        "summary": "Send Password Reset Email",
        "description": "Send a password reset email to the user with the provided email address.",
        "operationId": "sendResetEmail",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "example": "ivan@example.com"
                  }
                },
                "required": [
                  "email"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      }
    },
    "/auth/reset-password": {
      "post": {
        "summary": "Reset Password",
        "description": "Reset the user's password using the provided token and new password.",
        "operationId": "resetPassword",
        "tags": [
          "Auth"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "password": {
                    "type": "string",
                    "example": "newStrongPassword123"
                  },
                  "token": {
                    "type": "string",
                    "example": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  }
                },
                "required": [
                  "password",
                  "token"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      }
    },
    "/users": {
      "get": {
        "summary": "Get All Users List",
        "description": "Returning a list of all users form the database. Does`t require authorization. The data includes basic user information without password. Pagination is implemented with `page` and `limit` parameters.",
        "operationId": "getAllUsers",
        "tags": [
          "Users"
        ],
        "security": [],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Number of users per page",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          }
        }
      }
    },
    "/users/current": {
      "get": {
        "summary": "Get current user",
        "description": "Return current authenticated user info. Requires authorization.",
        "operationId": "getCurrentUser",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/users/{userId}": {
      "get": {
        "summary": "Get User by ID",
        "description": "Retrieve user information by their unique ID. Does not require authorization. The response includes basic user details without sensitive information.",
        "operationId": "getUserById",
        "tags": [
          "Users"
        ],
        "security": [],
        "parameters": [
          {
            "name": "userId",
            "in": "path",
            "description": "ID of the user to retrieve",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64f0c8a7a2b3c1d234567890"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      }
    },
    "/users/updateUser": {
      "patch": {
        "summary": "Update Current User Info",
        "description": "Update the information of the currently authenticated user. Requires authorization.",
        "operationId": "updateUser",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "Ivan Petrenko"
                  },
                  "email": {
                    "type": "string",
                    "example": "ivan@example.com"
                  },
                  "description": {
                    "type": "string",
                    "example": "New description about the user"
                  }
                },
                "minProperties": 1
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/users/avatar": {
      "patch": {
        "summary": "Update User Avatar",
        "description": "Update the avatar image of the currently authenticated user. Requires authorization.",
        "operationId": "updateUserAvatar",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "avatar": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/users/saved/{storyId}": {
      "post": {
        "summary": "Save story to user's saved list",
        "description": "Saves a story to the authenticated user's `savedStories` list by story ID. Requires authorization.",
        "operationId": "saveStory",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "name": "storyId",
            "in": "path",
            "description": "ID of the story to save",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64f0d1a2b3c4567890123456"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      },
      "delete": {
        "summary": "Delete story from user's saved list",
        "description": "Deletes a story from the authenticated user's `savedStories` list by story ID. Requires authorization.",
        "operationId": "deleteSavedStory",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "name": "storyId",
            "in": "path",
            "description": "ID of the story to delete",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64f0d1a2b3c4567890123456"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      }
    },
    "/stories": {
      "get": {
        "summary": "Get list of stories with pagination, sorting, and filtering",
        "description": "Retrieves a paginated list of stories with optional sorting and filtering by category or owner ID. Supports query parameters for page number, items per page, sort field, and sort order. Does't require authentication.",
        "operationId": "getStories",
        "tags": [
          "Stories"
        ],
        "security": [],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number for pagination",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "perPage",
            "in": "query",
            "description": "Number of stories per page",
            "required": false,
            "schema": {
              "type": "integer",
              "default": 10
            }
          },
          {
            "name": "sortBy",
            "in": "query",
            "description": "Field to sort by (title, article, category, ownerId, favoriteCount, createdAt)",
            "required": false,
            "schema": {
              "type": "string",
              "default": "createdAt"
            }
          },
          {
            "name": "sortOrder",
            "in": "query",
            "description": "Sort order (asc or desc)",
            "required": false,
            "schema": {
              "type": "string",
              "default": "asc"
            }
          },
          {
            "name": "category",
            "in": "query",
            "description": "Filter by category (ID)",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "ownerId",
            "in": "query",
            "description": "Filter by owner (user ID)",
            "required": false,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          }
        }
      },
      "post": {
        "summary": "Create a new story",
        "description": "Creates a new story with title, article, category, and image upload. Requires authentication.",
        "operationId": "createStory",
        "tags": [
          "Stories"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Story title",
                    "example": "Karpathian Adventure"
                  },
                  "article": {
                    "type": "string",
                    "description": "Story content",
                    "example": "Incredible trip to the mountains with friends..."
                  },
                  "category": {
                    "type": "string",
                    "description": "Category ID",
                    "example": "68efd834f1781f960b1e7a6c"
                  },
                  "img": {
                    "type": "string",
                    "format": "binary",
                    "description": "Image file for the story"
                  }
                },
                "required": [
                  "title",
                  "article",
                  "category",
                  "img"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "$ref": "#/components/responses/201"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          }
        }
      }
    },
    "/stories/{storyId}": {
      "get": {
        "summary": "Get story by ID",
        "description": "Retrieves a story by its ID. Does not require authentication.",
        "operationId": "getStoryById",
        "tags": [
          "Stories"
        ],
        "security": [],
        "parameters": [
          {
            "name": "storyId",
            "in": "path",
            "description": "Story ID",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64f1a2b3c456789012345678"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      },
      "patch": {
        "summary": "Update a story by ID",
        "description": "Updates an existing story by its ID. Allows updating title, article, category, and image. Requires authentication and authorization (only the story owner can update).",
        "operationId": "updateStoryById",
        "tags": [
          "Stories"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "name": "storyId",
            "in": "path",
            "required": true,
            "description": "ID of the story to update",
            "schema": {
              "type": "string",
              "example": "68efd834f1781f960b1e7a6c"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "title": {
                    "type": "string",
                    "description": "Updated story title",
                    "example": "Exciting Journey to the Carpathians"
                  },
                  "article": {
                    "type": "string",
                    "description": "Updated story content",
                    "example": "Exciting trip to the mountains with friends..."
                  },
                  "category": {
                    "type": "string",
                    "description": "Updated category ID",
                    "example": "68efd834f1781f960b1e7a6c"
                  },
                  "img": {
                    "type": "string",
                    "format": "binary",
                    "description": "Updated image file for the story"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "403": {
            "$ref": "#/components/responses/403"
          },
          "404": {
            "$ref": "#/components/responses/404"
          }
        }
      },
      "delete": {
        "summary": "Delete a story by ID",
        "description": "Deletes a story by its ID. Requires authentication. Only the owner of the story can delete it. Also removes the story ID from all users' saved stories and decrements the user's article count.",
        "operationId": "deleteStory",
        "tags": [
          "Stories"
        ],
        "security": [
          {
            "cookieAuth": []
          }
        ],
        "parameters": [
          {
            "name": "storyId",
            "in": "path",
            "description": "Story ID",
            "required": true,
            "schema": {
              "type": "string",
              "example": "64f1a2b3c456789012345678"
            }
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/200"
          },
          "400": {
            "$ref": "#/components/responses/400"
          },
          "401": {
            "$ref": "#/components/responses/401"
          },
          "403": {
            "$ref": "#/components/responses/403"
          },
          "404": {
            "$ref": "#/components/responses/404"
          },
          "500": {
            "$ref": "#/components/responses/500"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "user": {
        "type": "object",
        "required": [
          "_id",
          "name",
          "email"
        ],
        "properties": {
          "_id": {
            "type": "string",
            "description": "Unique identifier for the user, generated automatically by MongoDB",
            "example": "64f0c8a7a2b3c1d234567890"
          },
          "name": {
            "type": "string",
            "description": "User's name",
            "example": "Dmytro Romanenko or Дмитро Романенко"
          },
          "email": {
            "type": "string",
            "example": "ivan@example.com"
          },
          "avatarUrl": {
            "type": "string",
            "description": "URL to the user's avatar image generated automatically after upload the image to the server",
            "example": "https://res.cloudinary.com/dha4xvgfi/image/upload/v1759947947/aclxd7sbpsrb8hvsdwbe.jpg"
          },
          "description": {
            "type": "string",
            "description": "Short description of the user",
            "example": "Hi! I'm Dmytro. I love finding hidden gems in every trip."
          },
          "articlesAmount": {
            "type": "integer",
            "description": "Number of stories published by the user",
            "example": 13
          },
          "savedStories": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": [
              "64a0b91c9f12a81234abcd12"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-13T12:00:00Z"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-13T14:00:00Z"
          }
        }
      },
      "story": {
        "type": "object",
        "required": [
          "_id",
          "img",
          "title",
          "article",
          "category",
          "ownerId"
        ],
        "properties": {
          "_id": {
            "type": "string",
            "description": "Unique identifier for the story, generated automatically by MongoDB",
            "example": "64f0c8b7a2b3c1d234567891"
          },
          "img": {
            "type": "string",
            "description": "URL to the story's image generated automatically after upload the image to the server",
            "example": "https://res.cloudinary.com/dha4xvgfi/image/upload/v1759947947/aclxd7sbpsrb8hviowbe.jpg"
          },
          "title": {
            "type": "string",
            "description": "Story's title",
            "example": "Madagascar: A Miniature Planet of Wonders"
          },
          "article": {
            "type": "string",
            "description": "Story's article",
            "example": "Madagascar is a planet in miniature. We saw baobabs soaring into the sky and lemurs jumping right next to us. We traveled both by jeep and by boat to reach remote villages. The locals shared stories about their culture, which is different from all African ones. The most impressive thing was the \"Alley of the Baobabs\" at sunset - a picture that cannot be forgotten. Madagascar is a place where you feel the power and diversity of nature."
          },
          "category": {
            "type": "string",
            "description": "Story category id",
            "example": "68efd834f1781f960b1e7a6c"
          },
          "ownerId": {
            "type": "string",
            "description": "Story owner id",
            "example": "68efd834f1781f960b1e7a6c"
          },
          "favoriteCount": {
            "type": "integer",
            "example": 10
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-13T12:00:00Z"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-13T14:00:00Z"
          }
        }
      }
    },
    "responses": {
      "200": {
        "description": "OK - successful operation",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 200
                },
                "message": {
                  "type": "string",
                  "example": "Successfully fetched user"
                },
                "data": {
                  "type": "object"
                }
              },
              "required": [
                "status",
                "message",
                "data"
              ]
            }
          }
        }
      },
      "201": {
        "description": "Created - resource successfully created",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 201
                },
                "message": {
                  "type": "string",
                  "example": "User successfully registered"
                },
                "data": {
                  "type": "object"
                }
              },
              "required": [
                "status",
                "message",
                "data"
              ]
            }
          }
        }
      },
      "204": {
        "description": "No Content - successful operation with no content to return",
        "content": {}
      },
      "400": {
        "description": "Bad Request - uncorrect data or validation error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": [
                "status",
                "message"
              ],
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 400
                },
                "message": {
                  "type": "string",
                  "example": "The Email field must be a valid email address."
                },
                "errors": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "example": [
                    "The Name field must contain at least 3 characters.",
                    "The Password field is required."
                  ]
                }
              }
            }
          }
        }
      },
      "401": {
        "description": "Unauthorized - invalid or missing authentication token",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": [
                "status",
                "message"
              ],
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 401
                },
                "message": {
                  "type": "string",
                  "example": "Access token expired"
                }
              }
            }
          }
        }
      },
      "403": {
        "description": "Forbidden - the user does not have permission to access the resource",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 403
                },
                "message": {
                  "type": "string",
                  "example": "You can edit only your own stories"
                }
              },
              "required": [
                "status",
                "message"
              ]
            }
          }
        }
      },
      "404": {
        "description": "Not Found - the requested resource does not exist",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 404
                },
                "message": {
                  "type": "string",
                  "example": "User not found"
                }
              },
              "required": [
                "status",
                "message"
              ]
            }
          }
        }
      },
      "409": {
        "description": "Conflict - the request could not be completed due to a conflict with the current state of the resource",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 409
                },
                "message": {
                  "type": "string",
                  "example": "Email already in use"
                }
              },
              "required": [
                "status",
                "message"
              ]
            }
          }
        }
      },
      "500": {
        "description": "Internal Server Error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": [
                "status",
                "message"
              ],
              "properties": {
                "status": {
                  "type": "integer",
                  "example": 500
                },
                "message": {
                  "type": "string",
                  "example": "Internal Server Error"
                }
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "cookieAuth": {
        "type": "apiKey",
        "in": "cookie",
        "name": "accessToken",
        "description": "Authentication is done automatically via accessToken which is stored in cookies after successful registration or login. There is no need to manually enter the accessToken value in the field below."
      }
    }
  }
}