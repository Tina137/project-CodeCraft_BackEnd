{
  "openapi": "3.1.0",
  "info": {
    "version": "1.0.0",
    "title": "Contacts app",
    "license": {
      "name": "Apache 2.0",
      "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
    },
    "description": "Подорожник - ділись своїми подорожами"
  },
  "servers": [
    {
      "url": "http://localhost:3000"
    }
  ],
  "tags": [
    {
      "name": "Stories",
      "description": "Operations about stories."
    }
  ],
  "paths": {
    "/stories": {
      "get": {
        "tags": ["Stories"],
        "summary": "Get all stories",
        "operationId": "getStories",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/story" }
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      },
      "post": {
        "tags": ["Stories"],
        "summary": "Create a new story",
        "operationId": "createStory",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": { "$ref": "#/components/schemas/story" }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Story created successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/story" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      }
    },
    "/stories/{id}": {
      "get": {
        "tags": ["Stories"],
        "summary": "Get story by ID",
        "operationId": "getStoryById",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Story ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/story" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      },
      "patch": {
        "tags": ["Stories"],
        "summary": "Update a story",
        "operationId": "updateStory",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Story ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": { "$ref": "#/components/schemas/story" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Story updated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/story" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      },
      "delete": {
        "tags": ["Stories"],
        "summary": "Delete a story",
        "operationId": "deleteStory",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Story ID"
          }
        ],
        "responses": {
          "204": {
            "description": "Story deleted successfully"
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      }
    },
    "/stories/category/{categoryId}": {
      "get": {
        "tags": ["Stories"],
        "summary": "Get stories by category ID",
        "operationId": "getStoriesByCategory",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "categoryId",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Category ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/story" }
                }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      }
    },
    "/stories/{id}/favorite": {
      "patch": {
        "tags": ["Stories"],
        "summary": "Add or remove story from favorites",
        "operationId": "toggleFavorite",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": { "type": "string" },
            "description": "Story ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Favorite status updated",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/story" }
              }
            }
          },
          "400": { "$ref": "#/components/responses/400" },
          "401": { "$ref": "#/components/responses/401" },
          "500": { "$ref": "#/components/responses/500" }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "schemas": {
      "story": {
        "type": "object",
        "required": [
          "_id",
          "img",
          "title",
          "article",
          "category",
          "ownerId",
          "date",
          "favoriteCount"
        ],
        "properties": {
          "_id": {
            "description": "Story's id",
            "type": "string",
            "example": "65e4decdd286b30065d54af9"
          },
          "img": {
            "type": "string",
            "description": "Story's photo",
            "default": null,
            "format": "binary",
            "example": "https://res.cloudinary.com/dha4xvgfi/image/upload/v1759947947/aclxd7sbpsrb8hviowbe.jpg"
          },
          "title": {
            "description": "Story's title",
            "type": "string",
            "example": "Мадагаскар: острів дивовижних створінь"
          },
          "article": {
            "description": "Story's article",
            "type": "string",
            "example": "Мадагаскар — це планета в мініатюрі..."
          },
          "category": {
            "description": "Story category id",
            "type": "string",
            "example": "68efd834f1781f960b1e7a6c"
          },
          "ownerId": {
            "description": "Story owner id",
            "type": "string",
            "example": "68efd834f1781f960b1e7a6c"
          },
          "contactType": {
            "description": "Story's type",
            "type": "string",
            "enum": ["work", "home", "personal"]
          },
          "date": {
            "type": "string",
            "example": "2024-08-28"
          },
          "favoriteCount": {
            "type": "number",
            "example": 5
          }
        }
      }
    },
    "responses": {
      "400": {
        "description": "Bad Request",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["status", "message", "data"],
              "properties": {
                "status": { "type": "integer", "example": 400 },
                "message": { "type": "string", "example": "Bad Request" },
                "data": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              }
            }
          }
        }
      },
      "401": {
        "description": "Unauthorized error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["status", "message", "data"],
              "properties": {
                "status": { "type": "integer", "example": 401 },
                "message": { "type": "string", "example": "UnauthorizedError" },
                "data": {
                  "type": "object",
                  "required": ["message"],
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Access token expired"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "500": {
        "description": "Internal Server Error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "required": ["status", "message"],
              "properties": {
                "status": { "type": "integer", "example": 500 },
                "message": {
                  "type": "string",
                  "example": "Internal Server Error"
                }
              }
            }
          }
        }
      }
    }
  }
}
